flush ruleset

table inet filter {
	chain input {
		type filter hook input priority 0;
		policy drop;

		# established/related connections
		ct state established,related accept

		# invalid connections
		ct state invalid drop

		# loopback interface
		iif lo accept


		# ICMP & IGMP
		ip6 nexthdr icmpv6 accept
		ip protocol icmp accept
		ip protocol igmp accept

		# Allow the UDP portion of Traceroute
		udp dport { 33434-33524 } accept

		# SSH (port 22)
		tcp dport ssh accept

		# HTTP (port http)
		tcp dport http accept

		# HTTPS (port https)
		tcp dport https accept

		# RSYNC (port 873)
		tcp dport 873 accept

		log prefix "nftables-default-denied: " group 0
	}

	chain forward {
		type filter hook forward priority 0;
		policy drop;
	}

	chain output {
		type filter hook output priority 0;
		policy accept;
	}
}

table ip raw {
	chain postrouting {
		type filter hook postrouting priority -300;

		ip dscp set 0x08
	}
}
table ip6 raw {
	chain postrouting {
		type filter hook postrouting priority -300;

		ip6 dscp set 0x08
	}
}
